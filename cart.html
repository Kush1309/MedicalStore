<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - Raj pharma</title>
    <link rel="icon" href="images/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="styles/main.css">

</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">‚öïÔ∏è</span>
                Raj pharma
            </a>
            <ul class="nav-links" id="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a href="cart.html" class="active" style="position: relative;">
                        üõí Cart
                        <span class="cart-badge" id="cart-count">0</span>
                    </a></li>

                <!-- Auth Buttons -->
                <li id="auth-buttons">
                    <a href="index.html#login" class="btn btn-sm btn-primary">Login</a>
                </li>

                <!-- User Menu -->
                <li id="user-menu" style="display: none; position: relative;">
                    <a href="#" style="display: flex; align-items: center; gap: 0.5rem;">
                        <span>üë§</span>
                        <span id="user-name"></span>
                    </a>
                    <ul style="position: absolute; top: 100%; right: 0; background: var(--bg-secondary); border-radius: var(--radius-md); padding: 0.5rem; min-width: 150px; display: none; box-shadow: var(--shadow-lg);"
                        class="user-dropdown">
                        <li><a href="/admin" style="padding: 0.5rem 1rem; display: block; display: none;">Admin
                                Dashboard</a></li>
                        <li><a href="my-orders.html" style="padding: 0.5rem 1rem; display: block;">My Orders</a></li>
                        <li><a href="#" onclick="auth.logout(); return false;"
                                style="padding: 0.5rem 1rem; display: block; color: var(--error);">Logout</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h1
            style="font-size: 2.5rem; margin-bottom: 2rem; background: linear-gradient(135deg, #38bdf8 0%, #a78bfa 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
            Shopping Cart</h1>

        <div class="cart-grid-container"
            style="display: grid; grid-template-columns: 1fr 400px; gap: 2rem; align-items: start;">
            <!-- Cart Items -->
            <div>
                <div id="cart-items" class="glass" style="padding: 1.5rem;">
                    <!-- Cart items will be loaded here -->
                </div>
            </div>

            <!-- Order Summary -->
            <div class="glass sticky-sidebar" style="padding: 1.5rem; position: sticky; top: 100px;">
                <h2 style="font-size: 1.5rem; margin-bottom: 1.5rem;">Order Summary</h2>
                <!-- ... remains same ... -->

                <div
                    style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">Subtotal:</span>
                        <span id="subtotal">‚Çπ0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">Delivery:</span>
                        <span style="color: var(--success);">FREE</span>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; font-size: 1.25rem; font-weight: 700; margin-top: 1rem;">
                        <span>Total:</span>
                        <span id="total" style="color: var(--primary);">‚Çπ0</span>
                    </div>
                </div>

                <button class="btn btn-primary" style="width: 100%;" onclick="showCheckoutForm()">Proceed to
                    Checkout</button>
            </div>
        </div>

        <!-- Checkout Modal -->
        <div id="checkout-modal" class="modal">
            <div class="modal-content">
                <button class="modal-close" onclick="closeCheckoutForm()">&times;</button>
                <h2 style="margin-bottom: 1.5rem;">Checkout</h2>

                <form id="checkout-form" onsubmit="placeOrder(event)">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-input" name="name" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-input" name="email" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Phone *</label>
                        <input type="tel" class="form-input" name="phone" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Delivery Address *</label>
                        <textarea class="form-textarea" name="address" required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Payment Method</label>
                        <select class="form-select" name="paymentMethod" id="payment-method" required>
                            <option value="Cash on Delivery">Cash on Delivery</option>
                        </select>
                        <small style="color: var(--text-muted); margin-top: 0.5rem; display: block;">
                            üì¶ Pay with cash when your medicine is delivered to your doorstep.
                        </small>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">Place Order</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer style="background: #ffffff; border-top: 1px solid #e5e7eb; margin-top: 4rem;">
        <div class="container" style="padding: 3rem 0 2rem;">
            <!-- Brand Section -->
            <div style="margin-bottom: 3rem;">
                <div class="footer-brand">
                    <div class="footer-brand-logo">
                        <span>‚öïÔ∏è</span>
                        <h3>Raj pharma</h3>
                    </div>
                    <p class="brand-description">
                        Raj pharma is one of India's most trusted pharmacies, dispensing quality medicines at reasonable
                        prices to millions of happy customers - PAN India.
                    </p>
                </div>

                <!-- Footer Columns -->
                <div class="footer-grid">
                    <!-- Company Column -->
                    <div>
                        <h4 class="footer-heading">COMPANY</h4>
                        <ul class="footer-links">
                            <li><a href="#">About Raj pharma</a></li>
                            <li><a href="#">Career</a></li>
                            <li><a href="#">Sitemap</a></li>
                            <li><a href="/secure-admin-login">Admin Login</a></li>
                        </ul>
                    </div>

                    <!-- Our Policies Column -->
                    <div>
                        <h4 class="footer-heading">OUR POLICIES</h4>
                        <ul class="footer-links">
                            <li><a href="#">Terms & Conditions</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Fees & Payments Policy</a></li>
                            <li><a href="#">Shipping & Delivery Policy</a></li>
                            <li><a href="#">Return Refund Cancellation Policy</a></li>
                            <li><a href="#">Editorial Policy</a></li>
                            <li><a href="#">Caution Notice</a></li>
                        </ul>
                    </div>

                    <!-- Shopping Column -->
                    <div>
                        <h4 class="footer-heading">SHOPPING</h4>
                        <ul class="footer-links">
                            <li><a href="shop.html">Medicines A to Z</a></li>
                            <li><a href="shop.html">Shop by Categories</a></li>
                            <li><a href="#">Offers & Coupons</a></li>
                            <li><a href="#">FAQs</a></li>
                            <li><a href="#contact">Contact Us</a></li>
                        </ul>
                    </div>

                    <!-- Social Column -->
                    <div>
                        <h4 class="footer-heading">SOCIAL</h4>
                        <ul class="footer-links">
                            <li><a href="#">Facebook</a></li>
                            <li><a href="#">Twitter</a></li>
                            <li><a href="#">LinkedIn</a></li>
                            <li><a href="#">Youtube</a></li>
                            <li><a href="#">Instagram</a></li>
                        </ul>
                    </div>
                </div>

                <!-- Bottom Bar -->
                <div class="footer-bottom">
                    <p>
                        ¬© 2024 Raj pharma. All Rights Reserved | Author: Kushagra | Contact: 6394109197 | Location:
                        Kanpur
                        nagar
                    </p>
                </div>
            </div>
    </footer>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script src="js/chat.js"></script>
    <script>
        function displayCart() {
            const container = document.getElementById('cart-items');

            if (cart.items.length === 0) {
                container.innerHTML = `
          <div style="text-align: center; padding: 3rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">üõí</div>
            <h3 style="margin-bottom: 1rem;">Your cart is empty</h3>
            <a href="shop.html" class="btn btn-primary">Continue Shopping</a>
          </div>
        `;
                updateSummary();
                return;
            }

            container.innerHTML = cart.items.map(item => `
        <div class="cart-item" style="display: flex; gap: 1.5rem; padding: 1.5rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); align-items: center;">
          <img src="${item.medicine.image}" alt="${item.medicine.name}" style="width: 100px; height: 100px; object-fit: cover; border-radius: var(--radius-md);" onerror="if(this.src != 'images/medicine-placeholder.png') this.src='images/medicine-placeholder.png'">
          
          <div style="flex: 1;">
            <h3 style="font-size: 1.25rem; margin-bottom: 0.5rem;">${item.medicine.name}</h3>
            <p style="color: var(--text-secondary); font-size: 0.875rem;">${item.medicine.category}</p>
            <p style="color: var(--primary); font-weight: 700; font-size: 1.25rem; margin-top: 0.5rem;">‚Çπ${item.medicine.price}</p>
          </div>

          <div class="cart-item-actions" style="display: flex; align-items: center; gap: 1rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem; background: rgba(255, 255, 255, 0.05); padding: 0.5rem; border-radius: var(--radius-md);">
              <button class="btn btn-sm" style="padding: 0.25rem 0.75rem;" onclick="updateCartQuantity('${item.medicine._id}', ${item.quantity - 1})">-</button>
              <span style="min-width: 30px; text-align: center; font-weight: 600;">${item.quantity}</span>
              <button class="btn btn-sm" style="padding: 0.25rem 0.75rem;" onclick="updateCartQuantity('${item.medicine._id}', ${item.quantity + 1})">+</button>
            </div>
            <button class="btn btn-sm btn-danger" onclick="removeFromCart('${item.medicine._id}')">Remove</button>
          </div>
        </div>
      `).join('');

            updateSummary();
        }

        function updateSummary() {
            const total = cart.getTotal();
            document.getElementById('subtotal').textContent = `‚Çπ${total}`;
            document.getElementById('total').textContent = `‚Çπ${total}`;
        }

        function updateCartQuantity(medicineId, newQuantity) {
            cart.updateQuantity(medicineId, newQuantity);
            displayCart();
        }

        function removeFromCart(medicineId) {
            cart.remove(medicineId);
            displayCart();
            cart.showNotification('Item removed from cart', 'info');
        }

        function showCheckoutForm() {
            if (cart.items.length === 0) {
                cart.showNotification('Your cart is empty', 'error');
                return;
            }

            // Check if user is logged in
            if (!auth.isLoggedIn()) {
                cart.showNotification('Please login to place an order', 'error');
                setTimeout(() => {
                    window.location.href = 'index.html#login';
                }, 1000);
                return;
            }

            // Pre-fill form with user data if logged in
            const user = auth.getCurrentUser();
            if (user) {
                const form = document.getElementById('checkout-form');
                if (form.name) form.name.value = user.name || '';
                if (form.email) form.email.value = user.email || '';
            }

            document.getElementById('checkout-modal').classList.add('active');
        }

        function closeCheckoutForm() {
            document.getElementById('checkout-modal').classList.remove('active');
        }



        async function placeOrder(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const paymentMethod = formData.get('paymentMethod');

            const orderData = {
                customer: {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    address: formData.get('address')
                },
                items: cart.items.map(item => ({
                    medicine: item.medicine._id,
                    name: item.medicine.name,
                    price: item.medicine.price,
                    quantity: item.quantity
                })),
                totalAmount: cart.getTotal(),
                paymentMethod: paymentMethod
            };

            // Create order directly
            await createOrderDirect(orderData);
        }



        async function createOrderDirect(orderData) {
            try {
                const order = await api.createOrder(orderData);
                cart.showNotification('Order placed successfully! Order ID: ' + order._id, 'success');
                cart.clear();
                closeCheckoutForm();
                displayCart();

                // Redirect to home after 2 seconds
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            } catch (error) {
                console.error('Error placing order:', error);
                cart.showNotification(error.message || 'Failed to place order. Please try again.', 'error');
            }
        }

        // Display cart on page load - ensure cart is initialized first
        document.addEventListener('DOMContentLoaded', () => {
            // Give cart.init() time to complete
            setTimeout(() => {
                displayCart();
            }, 100);
        });
    </script>
</body>

</html>