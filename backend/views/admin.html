<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Raj pharma</title>
    <link rel="stylesheet" href="styles/main.css">
</head>

<body>
    <script>
        // Check if user is admin
        const userStr = localStorage.getItem('user');
        if (!userStr) {
            window.location.href = 'index.html';
        } else {
            const user = JSON.parse(userStr);
            if (user.role !== 'admin') {
                window.location.href = 'index.html';
            }
            // Display admin name
            document.addEventListener('DOMContentLoaded', () => {
                const adminNameEl = document.getElementById('admin-name');
                if (adminNameEl) {
                    adminNameEl.textContent = user.name;
                }
            });
        }
    </script>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">‚öïÔ∏è</span>
                Raj pharma Admin
            </a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a href="/admin" class="active">Admin</a></li>
                <li>
                    <span style="color: var(--text-secondary); margin-right: 0.5rem;">üë§ <span
                            id="admin-name"></span></span>
                </li>
                <li><a href="#" onclick="logout()" id="logout-btn">Logout</a></li>
            </ul>
        </div>
    </nav>

    <!-- Login Form -->
    <!-- Login Form Removed - Using Main Auth -->

    <!-- Admin Dashboard -->
    <div id="admin-section" class="container" style="display: block;">
        <!-- Stats Cards -->
        <div class="grid grid-3" style="margin-bottom: 2rem;">
            <div class="card glass">
                <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üíä</div>
                <h3
                    style="color: var(--text-secondary); font-size: 0.875rem; text-transform: uppercase; letter-spacing: 1px;">
                    Total Medicines</h3>
                <p id="total-medicines" style="font-size: 2.5rem; font-weight: 800; color: var(--primary);">0</p>
            </div>
            <div class="card glass">
                <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üì¶</div>
                <h3
                    style="color: var(--text-secondary); font-size: 0.875rem; text-transform: uppercase; letter-spacing: 1px;">
                    Total Orders</h3>
                <p id="total-orders" style="font-size: 2.5rem; font-weight: 800; color: var(--secondary);">0</p>
            </div>
            <div class="card glass">
                <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üí∞</div>
                <h3
                    style="color: var(--text-secondary); font-size: 0.875rem; text-transform: uppercase; letter-spacing: 1px;">
                    Total Revenue</h3>
                <p id="total-revenue" style="font-size: 2.5rem; font-weight: 800; color: var(--accent);">‚Çπ0</p>
            </div>
        </div>

        <!-- Tabs -->
        <div
            style="margin-bottom: 2rem; display: flex; gap: 1rem; border-bottom: 2px solid rgba(255, 255, 255, 0.1); overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch;">
            <button class="tab-btn active" onclick="switchTab('medicines')">Medicines</button>
            <button class="tab-btn" onclick="switchTab('orders')">Orders</button>
            <button class="tab-btn" onclick="switchTab('inquiries')">Inquiries</button>
        </div>

        <!-- Medicines Tab -->
        <div id="medicines-tab" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="font-size: 1.75rem;">Manage Medicines</h2>
                <button class="btn btn-primary" onclick="showAddMedicineForm()">+ Add Medicine</button>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Discount</th>
                            <th>Stock</th>
                            <th>Manufacturer</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="medicines-table">
                        <tr>
                            <td colspan="7" style="text-align: center;">
                                <div class="spinner"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Orders Tab -->
        <div id="orders-tab" class="tab-content" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="font-size: 1.75rem;">Manage Orders</h2>
                <button class="btn btn-outline" onclick="exportOrders()">üì• Export Orders</button>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Items</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="orders-table">
                        <tr>
                            <td colspan="7" style="text-align: center;">
                                <div class="spinner"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Inquiries Tab -->
        <div id="inquiries-tab" class="tab-content" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="font-size: 1.75rem;">User Inquiries</h2>
                <button class="btn btn-outline" onclick="exportInquiries()">üì• Export Inquiries</button>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Contact info</th>
                            <th>Address</th>
                            <th>Message</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inquiries-table">
                        <tr>
                            <td colspan="7" style="text-align: center;">
                                <div class="spinner"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add/Edit Medicine Modal -->
    <div id="medicine-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeMedicineModal()">&times;</button>
            <h2 id="medicine-modal-title" style="margin-bottom: 1.5rem;">Add Medicine</h2>

            <form id="medicine-form" onsubmit="saveMedicine(event)">
                <input type="hidden" name="medicineId">

                <div class="form-group">
                    <label class="form-label">Name *</label>
                    <input type="text" class="form-input" name="name" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Description *</label>
                    <textarea class="form-textarea" name="description" required></textarea>
                </div>

                <div class="grid grid-2 responsive-grid-1-mobile" style="gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Price (‚Çπ) *</label>
                        <input type="number" class="form-input" name="price" min="0" step="0.01" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Discount (%) </label>
                        <input type="number" class="form-input" name="discount" min="0" max="100" value="0" step="1">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Stock *</label>
                    <input type="number" class="form-input" name="stock" min="0" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Category *</label>
                    <select class="form-select" name="category" required>
                        <option value="Pain Relief">Pain Relief</option>
                        <option value="Antibiotics">Antibiotics</option>
                        <option value="Vitamins">Vitamins</option>
                        <option value="Cold & Flu">Cold & Flu</option>
                        <option value="Diabetes">Diabetes</option>
                        <option value="Heart Care">Heart Care</option>
                        <option value="Digestive">Digestive</option>
                        <option value="Protection">Protection</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Manufacturer *</label>
                    <input type="text" class="form-input" name="manufacturer" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Product Image *</label>

                    <!-- Toggle between URL and Upload -->
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="radio" name="imageInputType" value="url" checked onchange="toggleImageInput()">
                            <span>Use Image URL</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="radio" name="imageInputType" value="upload" onchange="toggleImageInput()">
                            <span>Upload Image File</span>
                        </label>
                    </div>

                    <!-- URL Input -->
                    <div id="url-input-section">
                        <input type="url" class="form-input" name="image" id="image-url"
                            placeholder="https://example.com/image.jpg">
                    </div>

                    <!-- File Upload Input -->
                    <div id="file-input-section" style="display: none;">
                        <input type="file" class="form-input" id="image-file" accept="image/*"
                            onchange="previewImage(event)">
                        <small style="color: var(--text-secondary); display: block; margin-top: 0.5rem;">
                            Supported formats: JPG, PNG, GIF, WEBP (Max 5MB)
                        </small>
                    </div>

                    <!-- Image Preview -->
                    <div id="image-preview-container" style="margin-top: 1rem; display: none;">
                        <img id="image-preview" src="" alt="Preview"
                            style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 2px solid var(--primary);">
                        <button type="button" class="btn btn-sm btn-outline" onclick="clearImagePreview()"
                            style="margin-top: 0.5rem;">Clear Image</button>
                    </div>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" name="prescription_required" style="width: auto;">
                        <span class="form-label" style="margin: 0;">Prescription Required</span>
                    </label>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">Save Medicine</button>
            </form>
        </div>
    </div>

    <style>
        .tab-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.125rem;
            font-weight: 600;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all var(--transition-base);
            border-bottom: 3px solid transparent;
            font-family: inherit;
        }

        .tab-btn:hover {
            color: var(--primary-light);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
    </style>

    <script src="js/api.js"></script>
    <script src="js/main.js"></script>
    <script>
        let currentMedicines = [];
        let currentOrders = [];
        let currentInquiries = [];

        // Auto-load on start
        loadDashboardData();

        function showAdminDashboard() {
            // Deprecated but kept if called references exist
            loadDashboardData();
        }

        async function logout() {
            try {
                await fetch('/api/secure-admin-auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
            } catch (error) {
                console.error('Logout error:', error);
            } finally {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = 'index.html';
            }
        }

        async function loadDashboardData() {
            await loadMedicinesAdmin();
            await loadOrders();
            await loadInquiries();
            updateStats();
        }

        async function loadMedicinesAdmin() {
            try {
                const medicines = await api.getMedicines();
                currentMedicines = medicines;
                displayMedicinesTable(medicines);
            } catch (error) {
                console.error('Error loading medicines:', error);
            }
        }

        function displayMedicinesTable(medicines) {
            const tbody = document.getElementById('medicines-table');

            if (medicines.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-secondary);">No medicines found</td></tr>';
                return;
            }

            tbody.innerHTML = medicines.map(medicine => {
                const discountValue = medicine.discount || 0;
                const hasDiscount = discountValue > 0;
                const finalPrice = hasDiscount ? (medicine.price * (1 - discountValue / 100)).toFixed(2) : medicine.price;

                return `
        <tr>
          <td><strong>${medicine.name}</strong></td>
          <td><span class="badge badge-primary">${medicine.category}</span></td>
          <td>
            ${hasDiscount ? `<div><span style="text-decoration: line-through; color: var(--text-muted); font-size: 0.875rem;">‚Çπ${medicine.price}</span><br><strong style="color: var(--secondary);">‚Çπ${finalPrice}</strong></div>` : `‚Çπ${medicine.price}`}
          </td>
          <td>
            ${hasDiscount ? `<span class="badge badge-success">${discountValue}% OFF</span>` : `<span style="color: var(--text-muted);">-</span>`}
          </td>
          <td>
            <span class="${medicine.stock === 0 ? 'stock-out' : medicine.stock < 20 ? 'stock-low' : 'stock-available'}">
              ${medicine.stock}
            </span>
          </td>
          <td>${medicine.manufacturer}</td>
          <td>
            <button class="btn btn-sm btn-outline" onclick="editMedicine('${medicine._id}')">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteMedicine('${medicine._id}')">Delete</button>
          </td>
        </tr>
      `;
            }).join('');
        }

        async function loadOrders() {
            try {
                const orders = await api.getOrders();
                currentOrders = orders;
                displayOrdersTable(orders);
            } catch (error) {
                console.error('Error loading orders:', error);
                document.getElementById('orders-table').innerHTML =
                    '<tr><td colspan="7" style="text-align: center; color: var(--error);">Failed to load orders. Please check your credentials.</td></tr>';
            }
        }

        function displayOrdersTable(orders) {
            // ... (existing code for orders)
            const tbody = document.getElementById('orders-table');

            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-secondary);">No orders found</td></tr>';
                return;
            }

            tbody.innerHTML = orders.map(order => {
                return `
          <tr>
            <td><code style="font-size: 0.75rem;">${order._id.substring(0, 8)}...</code></td>
            <td>
              <strong>${order.customer.name}</strong><br>
              <small style="color: var(--text-muted);">${order.customer.email}</small>
            </td>
            <td>${order.items.length} item(s)</td>
            <td><strong>‚Çπ${order.totalAmount}</strong></td>
            <td>
              <select class="form-select" style="padding: 0.25rem 0.5rem; font-size: 0.875rem;" onchange="updateOrderStatus('${order._id}', this.value)">
                <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
                <option value="Processing" ${order.status === 'Processing' ? 'selected' : ''}>Processing</option>
                <option value="Shipped" ${order.status === 'Shipped' ? 'selected' : ''}>Shipped</option>
                <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                <option value="Cancelled" ${order.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
              </select>
            </td>
            <td><small>${new Date(order.createdAt).toLocaleDateString()}</small></td>
            <td>
              <button class="btn btn-sm btn-outline" onclick="viewOrderDetails('${order._id}')">View</button>
            </td>
          </tr>
        `;
            }).join('');
        }

        async function loadInquiries() {
            try {
                const inquiries = await api.getInquiries();
                currentInquiries = inquiries;
                displayInquiriesTable(inquiries);
            } catch (error) {
                console.error('Error loading inquiries:', error);
                document.getElementById('inquiries-table').innerHTML =
                    '<tr><td colspan="7" style="text-align: center; color: var(--error);">Failed to load inquiries.</td></tr>';
            }
        }

        function displayInquiriesTable(inquiries) {
            const tbody = document.getElementById('inquiries-table');

            if (inquiries.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-secondary);">No inquiries found</td></tr>';
                return;
            }

            tbody.innerHTML = inquiries.map(inqu => `
          <tr>
            <td><strong>${inqu.name}</strong></td>
            <td>
              ${inqu.email}<br>
              <small>${inqu.phone}</small>
            </td>
            <td><small>${inqu.address}</small></td>
            <td><div style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${inqu.message}">${inqu.message}</div></td>
            <td>
              <select class="form-select" style="padding: 0.25rem 0.5rem; font-size: 0.875rem;" onchange="updateInquiryStatus('${inqu._id}', this.value)">
                <option value="New" ${inqu.status === 'New' ? 'selected' : ''}>New</option>
                <option value="Contacted" ${inqu.status === 'Contacted' ? 'selected' : ''}>Contacted</option>
                <option value="Resolved" ${inqu.status === 'Resolved' ? 'selected' : ''}>Resolved</option>
              </select>
            </td>
            <td><small>${new Date(inqu.createdAt).toLocaleDateString()}</small></td>
            <td>
              <button class="btn btn-sm btn-outline" onclick="viewInquiryDetails('${inqu._id}')">View</button>
            </td>
          </tr>
        `).join('');
        }

        async function updateInquiryStatus(id, status) {
            try {
                // We need to add this to api.js or handle it here
                const token = localStorage.getItem('token');
                await fetch(`/api/inquiries/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ status })
                });
                cart.showNotification('Inquiry status updated', 'success');
                await loadInquiries();
            } catch (error) {
                console.error('Error updating inquiry:', error);
                cart.showNotification('Failed to update inquiry status', 'error');
            }
        }

        function exportOrders() {
            window.open(api.getOrdersExportUrl(), '_blank');
        }

        function exportInquiries() {
            window.open(api.getInquiriesExportUrl(), '_blank');
        }

        function updateStats() {
            document.getElementById('total-medicines').textContent = currentMedicines.length;
            document.getElementById('total-orders').textContent = currentOrders.length;

            const revenue = currentOrders
                .filter(order => order.status !== 'Cancelled')
                .reduce((sum, order) => sum + order.totalAmount, 0);
            document.getElementById('total-revenue').textContent = `‚Çπ${revenue}`;
        }

        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.getElementById('medicines-tab').style.display = tab === 'medicines' ? 'block' : 'none';
            document.getElementById('orders-tab').style.display = tab === 'orders' ? 'block' : 'none';
            document.getElementById('inquiries-tab').style.display = tab === 'inquiries' ? 'block' : 'none';
        }

        function toggleImageInput() {
            const inputType = document.querySelector('input[name="imageInputType"]:checked').value;
            const urlSection = document.getElementById('url-input-section');
            const fileSection = document.getElementById('file-input-section');

            if (inputType === 'url') {
                urlSection.style.display = 'block';
                fileSection.style.display = 'none';
                clearImagePreview();
            } else {
                urlSection.style.display = 'none';
                fileSection.style.display = 'block';
                document.getElementById('image-url').value = '';
            }
        }

        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                // Check file size (5MB limit)
                if (file.size > 5 * 1024 * 1024) {
                    cart.showNotification('Image file is too large. Maximum size is 5MB', 'error');
                    event.target.value = '';
                    return;
                }

                // Preview the image
                const reader = new FileReader();
                reader.onload = function (e) {
                    const preview = document.getElementById('image-preview');
                    const container = document.getElementById('image-preview-container');
                    preview.src = e.target.result;
                    container.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        function clearImagePreview() {
            const preview = document.getElementById('image-preview');
            const container = document.getElementById('image-preview-container');
            const fileInput = document.getElementById('image-file');

            preview.src = '';
            container.style.display = 'none';
            if (fileInput) fileInput.value = '';
        }

        function showAddMedicineForm() {
            document.getElementById('medicine-modal-title').textContent = 'Add Medicine';
            document.getElementById('medicine-form').reset();
            clearImagePreview();
            // Reset to URL mode by default
            document.querySelector('input[name="imageInputType"][value="url"]').checked = true;
            toggleImageInput();
            document.getElementById('medicine-modal').classList.add('active');
        }

        function closeMedicineModal() {
            document.getElementById('medicine-modal').classList.remove('active');
        }

        async function editMedicine(id) {
            const medicine = currentMedicines.find(m => m._id === id);
            if (!medicine) return;

            document.getElementById('medicine-modal-title').textContent = 'Edit Medicine';
            const form = document.getElementById('medicine-form');

            form.medicineId.value = medicine._id;
            form.name.value = medicine.name;
            form.description.value = medicine.description;
            form.price.value = medicine.price;
            form.discount.value = medicine.discount || 0;
            form.stock.value = medicine.stock;
            form.category.value = medicine.category;
            form.manufacturer.value = medicine.manufacturer;
            form.prescription_required.checked = medicine.prescription_required;

            // Set image - default to URL mode with existing image
            clearImagePreview();
            document.querySelector('input[name="imageInputType"][value="url"]').checked = true;
            toggleImageInput();
            form.image.value = medicine.image || '';

            // Show preview if there's an existing image
            if (medicine.image) {
                const preview = document.getElementById('image-preview');
                const container = document.getElementById('image-preview-container');
                preview.src = medicine.image;
                container.style.display = 'block';
            }

            document.getElementById('medicine-modal').classList.add('active');
        }

        async function uploadImageFile(file) {
            const formData = new FormData();
            formData.append('image', file);

            const token = localStorage.getItem('token');
            const response = await fetch('/api/medicines/upload-image', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                body: formData,
                credentials: 'include'
            });

            if (!response.ok) {
                throw new Error('Failed to upload image');
            }

            const data = await response.json();
            return data.imageUrl;
        }

        async function saveMedicine(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const inputType = document.querySelector('input[name="imageInputType"]:checked').value;

            let imageUrl = formData.get('image') || undefined;

            try {
                // If user selected file upload, upload the file first
                if (inputType === 'upload') {
                    const fileInput = document.getElementById('image-file');
                    if (fileInput.files[0]) {
                        cart.showNotification('Uploading image...', 'info');
                        imageUrl = await uploadImageFile(fileInput.files[0]);
                    }
                }

                const medicineData = {
                    name: formData.get('name'),
                    description: formData.get('description'),
                    price: parseFloat(formData.get('price')),
                    discount: parseFloat(formData.get('discount')) || 0,
                    stock: parseInt(formData.get('stock')),
                    category: formData.get('category'),
                    manufacturer: formData.get('manufacturer'),
                    image: imageUrl,
                    prescription_required: formData.get('prescription_required') === 'on'
                };

                const medicineId = formData.get('medicineId');

                if (medicineId) {
                    await api.updateMedicine(medicineId, medicineData);
                    cart.showNotification('Medicine updated successfully', 'success');
                } else {
                    await api.createMedicine(medicineData);
                    cart.showNotification('Medicine added successfully', 'success');
                }

                closeMedicineModal();
                await loadMedicinesAdmin();
                updateStats();
            } catch (error) {
                console.error('Error saving medicine:', error);
                cart.showNotification('Failed to save medicine', 'error');
            }
        }

        async function deleteMedicine(id) {
            if (!confirm('Are you sure you want to delete this medicine?')) return;

            try {
                await api.deleteMedicine(id);
                cart.showNotification('Medicine deleted successfully', 'success');
                await loadMedicinesAdmin();
                updateStats();
            } catch (error) {
                console.error('Error deleting medicine:', error);
                cart.showNotification('Failed to delete medicine', 'error');
            }
        }

        async function updateOrderStatus(orderId, newStatus) {
            try {
                await api.updateOrderStatus(orderId, newStatus);
                cart.showNotification('Order status updated', 'success');
                await loadOrders();
                updateStats();
            } catch (error) {
                console.error('Error updating order:', error);
                cart.showNotification('Failed to update order status', 'error');
            }
        }

        function viewOrderDetails(orderId) {
            const order = currentOrders.find(o => o._id === orderId);
            if (!order) return;

            const itemsHtml = order.items.map(item => `
                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                    <span>${item.name} x ${item.quantity}</span>
                    <span>‚Çπ${item.price * item.quantity}</span>
                </div>
            `).join('');

            showDetailsModal('Order Details', `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div>
                        <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Customer Information</h4>
                        <p><strong>Name:</strong> ${order.customer.name}</p>
                        <p><strong>Email:</strong> ${order.customer.email}</p>
                        <p><strong>Phone:</strong> ${order.customer.phone}</p>
                        <p><strong>Address:</strong> ${order.customer.address}</p>
                    </div>
                    <div>
                        <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Order Information</h4>
                        <p><strong>Status:</strong> ${order.status}</p>
                        <p><strong>Payment:</strong> ${order.paymentMethod} (${order.paymentStatus})</p>
                        <p><strong>Date:</strong> ${new Date(order.createdAt).toLocaleString()}</p>
                        <p><strong>Total:</strong> ‚Çπ${order.totalAmount}</p>
                    </div>
                </div>
                <div style="margin-top: 1.5rem;">
                    <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Order Items</h4>
                    ${itemsHtml}
                </div>
            `);
        }

        function viewInquiryDetails(inquiryId) {
            const inqu = currentInquiries.find(i => i._id === inquiryId);
            if (!inqu) return;

            showDetailsModal('Inquiry Details', `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div>
                        <h4 style="color: var(--primary); margin-bottom: 0.5rem;">User Information</h4>
                        <p><strong>Name:</strong> ${inqu.name}</p>
                        <p><strong>Email:</strong> ${inqu.email}</p>
                        <p><strong>Phone:</strong> ${inqu.phone}</p>
                        <p><strong>Address:</strong> ${inqu.address}</p>
                    </div>
                    <div>
                        <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Inquiry Info</h4>
                        <p><strong>Status:</strong> ${inqu.status}</p>
                        <p><strong>Date:</strong> ${new Date(inqu.createdAt).toLocaleString()}</p>
                    </div>
                </div>
                <div style="margin-top: 1.5rem;">
                    <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Message</h4>
                    <div style="padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 8px; font-style: italic;">
                        "${inqu.message}"
                    </div>
                </div>
            `);
        }

        function showDetailsModal(title, contentHtml) {
            let modal = document.getElementById('details-modal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'details-modal';
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 700px;">
                        <button class="modal-close" onclick="closeDetailsModal()">&times;</button>
                        <h2 id="details-modal-title" style="margin-bottom: 1.5rem; color: var(--primary);"></h2>
                        <div id="details-modal-body"></div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            document.getElementById('details-modal-title').textContent = title;
            document.getElementById('details-modal-body').innerHTML = contentHtml;
            modal.classList.add('active');
        }

        function closeDetailsModal() {
            document.getElementById('details-modal').classList.remove('active');
        }

        // Check for existing session (Removed legacy check)

    </script>
</body>

</html>